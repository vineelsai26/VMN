# This workflow will build a golang project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-go

name: Go

on:
  push:
    branches: ["*"]
    tags: "v*"
  pull_request:
    branches: ["main"]

env:
  GoVersion: 1.22

jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GoVersion }}

      - name: Build
        run: go build -v ./...

  test:
    strategy:
      matrix:
        os: [windows-latest, macos-latest, ubuntu-latest ]
    runs-on: ${{ matrix.os }}
    needs: build
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GoVersion }}

      - name: Test
        run: go test -timeout 3h -v ./...

  release_repo:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
    runs-on: ${{ matrix.os }}
    needs: test
    permissions:
      id-token: write
      contents: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GoVersion }}

      - name: Configure AWS credentials from Production account
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ASSUME_ROLE }}
          aws-region: ${{ vars.AWS_REGION }}

      - name: Setup VMN
        run: |
          go build
          cp vmn /usr/local/bin/vmn

      - name: Build Python
        run: |
          vmn --compile python install 3.12.3
          vmn --compile python install 3.12.2
          vmn --compile python install 3.12.1
          vmn --compile python install 3.11.9
          vmn --compile python install 3.11.8
          vmn --compile python install 3.11.7
          vmn --compile python install 3.11.6
          vmn --compile python install 3.11.5
          vmn --compile python install 3.11.4
          vmn --compile python install 3.11.3
          vmn --compile python install 3.11.2
          vmn --compile python install 3.11.1

          vmn --compile python install 3.10.14
          vmn --compile python install 3.10.13
          vmn --compile python install 3.10.12
          vmn --compile python install 3.10.11
          vmn --compile python install 3.10.10
          vmn --compile python install 3.10.9
          vmn --compile python install 3.10.8
          vmn --compile python install 3.10.7
          vmn --compile python install 3.10.6
          vmn --compile python install 3.10.5
          vmn --compile python install 3.10.4
          vmn --compile python install 3.10.3
          vmn --compile python install 3.10.2
          vmn --compile python install 3.10.1

          vmn --compile python install 3.9.19
          vmn --compile python install 3.9.18
          vmn --compile python install 3.9.17
          vmn --compile python install 3.9.16
          vmn --compile python install 3.9.15
          vmn --compile python install 3.9.14
          vmn --compile python install 3.9.13
          vmn --compile python install 3.9.12
          vmn --compile python install 3.9.11
          vmn --compile python install 3.9.10
          vmn --compile python install 3.9.9
          vmn --compile python install 3.9.8
          vmn --compile python install 3.9.7
          vmn --compile python install 3.9.6
          vmn --compile python install 3.9.5
          vmn --compile python install 3.9.4
          vmn --compile python install 3.9.3
          vmn --compile python install 3.9.2
          vmn --compile python install 3.9.1

      - name: "DRY RUN: Upload Python package to S3"
        if: github.ref != 'refs/heads/main'
        run: |
          OS=$(uname -s)
          if [[ $OS == "Linux" ]]; then
            cd $HOME/.vmn/python/v3.12.3/ && tar -czf python-3.12.3.tar.gz * && aws s3 cp python-3.12.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.12.2/ && tar -czf python-3.12.2.tar.gz * && aws s3 cp python-3.12.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.12.1/ && tar -czf python-3.12.1.tar.gz * && aws s3 cp python-3.12.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/

            cd $HOME/.vmn/python/v3.11.9/ && tar -czf python-3.11.9.tar.gz * && aws s3 cp python-3.11.9.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.8/ && tar -czf python-3.11.8.tar.gz * && aws s3 cp python-3.11.8.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.7/ && tar -czf python-3.11.7.tar.gz * && aws s3 cp python-3.11.7.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.6/ && tar -czf python-3.11.6.tar.gz * && aws s3 cp python-3.11.6.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.5/ && tar -czf python-3.11.5.tar.gz * && aws s3 cp python-3.11.5.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.4/ && tar -czf python-3.11.4.tar.gz * && aws s3 cp python-3.11.4.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.3/ && tar -czf python-3.11.3.tar.gz * && aws s3 cp python-3.11.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.2/ && tar -czf python-3.11.2.tar.gz * && aws s3 cp python-3.11.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.1/ && tar -czf python-3.11.1.tar.gz * && aws s3 cp python-3.11.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/

            cd $HOME/.vmn/python/v3.10.14/ && tar -czf python-3.10.14.tar.gz * && aws s3 cp python-3.10.14.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.13/ && tar -czf python-3.10.13.tar.gz * && aws s3 cp python-3.10.13.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.12/ && tar -czf python-3.10.12.tar.gz * && aws s3 cp python-3.10.12.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.11/ && tar -czf python-3.10.11.tar.gz * && aws s3 cp python-3.10.11.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.10/ && tar -czf python-3.10.10.tar.gz * && aws s3 cp python-3.10.10.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.9/ && tar -czf python-3.10.9.tar.gz * && aws s3 cp python-3.10.9.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.8/ && tar -czf python-3.10.8.tar.gz * && aws s3 cp python-3.10.8.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.7/ && tar -czf python-3.10.7.tar.gz * && aws s3 cp python-3.10.7.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.6/ && tar -czf python-3.10.6.tar.gz * && aws s3 cp python-3.10.6.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.5/ && tar -czf python-3.10.5.tar.gz * && aws s3 cp python-3.10.5.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.4/ && tar -czf python-3.10.4.tar.gz * && aws s3 cp python-3.10.4.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.3/ && tar -czf python-3.10.3.tar.gz * && aws s3 cp python-3.10.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.2/ && tar -czf python-3.10.2.tar.gz * && aws s3 cp python-3.10.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.1/ && tar -czf python-3.10.1.tar.gz * && aws s3 cp python-3.10.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/

            cd $HOME/.vmn/python/v3.9.19/ && tar -czf python-3.9.19.tar.gz * && aws s3 cp python-3.9.19.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.18/ && tar -czf python-3.9.18.tar.gz * && aws s3 cp python-3.9.18.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.17/ && tar -czf python-3.9.17.tar.gz * && aws s3 cp python-3.9.17.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.16/ && tar -czf python-3.9.16.tar.gz * && aws s3 cp python-3.9.16.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.15/ && tar -czf python-3.9.15.tar.gz * && aws s3 cp python-3.9.15.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.14/ && tar -czf python-3.9.14.tar.gz * && aws s3 cp python-3.9.14.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.13/ && tar -czf python-3.9.13.tar.gz * && aws s3 cp python-3.9.13.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.12/ && tar -czf python-3.9.12.tar.gz * && aws s3 cp python-3.9.12.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.11/ && tar -czf python-3.9.11.tar.gz * && aws s3 cp python-3.9.11.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.10/ && tar -czf python-3.9.10.tar.gz * && aws s3 cp python-3.9.10.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.9/ && tar -czf python-3.9.9.tar.gz * && aws s3 cp python-3.9.9.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.8/ && tar -czf python-3.9.8.tar.gz * && aws s3 cp python-3.9.8.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.7/ && tar -czf python-3.9.7.tar.gz * && aws s3 cp python-3.9.7.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.6/ && tar -czf python-3.9.6.tar.gz * && aws s3 cp python-3.9.6.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.5/ && tar -czf python-3.9.5.tar.gz * && aws s3 cp python-3.9.5.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.4/ && tar -czf python-3.9.4.tar.gz * && aws s3 cp python-3.9.4.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.3/ && tar -czf python-3.9.3.tar.gz * && aws s3 cp python-3.9.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.2/ && tar -czf python-3.9.2.tar.gz * && aws s3 cp python-3.9.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.1/ && tar -czf python-3.9.1.tar.gz * && aws s3 cp python-3.9.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
          elif [[ $OS == "Darwin" ]]; then
            cd $HOME/.vmn/python/v3.12.3/ && tar -czf python-3.12.3.tar.gz * && aws s3 cp python-3.12.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.12.2/ && tar -czf python-3.12.2.tar.gz * && aws s3 cp python-3.12.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.12.1/ && tar -czf python-3.12.1.tar.gz * && aws s3 cp python-3.12.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/

            cd $HOME/.vmn/python/v3.11.9/ && tar -czf python-3.11.9.tar.gz * && aws s3 cp python-3.11.9.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.8/ && tar -czf python-3.11.8.tar.gz * && aws s3 cp python-3.11.8.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.7/ && tar -czf python-3.11.7.tar.gz * && aws s3 cp python-3.11.7.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.6/ && tar -czf python-3.11.6.tar.gz * && aws s3 cp python-3.11.6.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.5/ && tar -czf python-3.11.5.tar.gz * && aws s3 cp python-3.11.5.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.4/ && tar -czf python-3.11.4.tar.gz * && aws s3 cp python-3.11.4.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.3/ && tar -czf python-3.11.3.tar.gz * && aws s3 cp python-3.11.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.2/ && tar -czf python-3.11.2.tar.gz * && aws s3 cp python-3.11.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.1/ && tar -czf python-3.11.1.tar.gz * && aws s3 cp python-3.11.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/

            cd $HOME/.vmn/python/v3.10.14/ && tar -czf python-3.10.14.tar.gz * && aws s3 cp python-3.10.14.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.13/ && tar -czf python-3.10.13.tar.gz * && aws s3 cp python-3.10.13.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.12/ && tar -czf python-3.10.12.tar.gz * && aws s3 cp python-3.10.12.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.11/ && tar -czf python-3.10.11.tar.gz * && aws s3 cp python-3.10.11.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.10/ && tar -czf python-3.10.10.tar.gz * && aws s3 cp python-3.10.10.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.9/ && tar -czf python-3.10.9.tar.gz * && aws s3 cp python-3.10.9.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.8/ && tar -czf python-3.10.8.tar.gz * && aws s3 cp python-3.10.8.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.7/ && tar -czf python-3.10.7.tar.gz * && aws s3 cp python-3.10.7.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.6/ && tar -czf python-3.10.6.tar.gz * && aws s3 cp python-3.10.6.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.5/ && tar -czf python-3.10.5.tar.gz * && aws s3 cp python-3.10.5.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.4/ && tar -czf python-3.10.4.tar.gz * && aws s3 cp python-3.10.4.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.3/ && tar -czf python-3.10.3.tar.gz * && aws s3 cp python-3.10.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.2/ && tar -czf python-3.10.2.tar.gz * && aws s3 cp python-3.10.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.1/ && tar -czf python-3.10.1.tar.gz * && aws s3 cp python-3.10.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/

            cd $HOME/.vmn/python/v3.9.19/ && tar -czf python-3.9.19.tar.gz * && aws s3 cp python-3.9.19.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.18/ && tar -czf python-3.9.18.tar.gz * && aws s3 cp python-3.9.18.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.17/ && tar -czf python-3.9.17.tar.gz * && aws s3 cp python-3.9.17.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.16/ && tar -czf python-3.9.16.tar.gz * && aws s3 cp python-3.9.16.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.15/ && tar -czf python-3.9.15.tar.gz * && aws s3 cp python-3.9.15.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.14/ && tar -czf python-3.9.14.tar.gz * && aws s3 cp python-3.9.14.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.13/ && tar -czf python-3.9.13.tar.gz * && aws s3 cp python-3.9.13.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.12/ && tar -czf python-3.9.12.tar.gz * && aws s3 cp python-3.9.12.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.11/ && tar -czf python-3.9.11.tar.gz * && aws s3 cp python-3.9.11.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.10/ && tar -czf python-3.9.10.tar.gz * && aws s3 cp python-3.9.10.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.9/ && tar -czf python-3.9.9.tar.gz * && aws s3 cp python-3.9.9.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.8/ && tar -czf python-3.9.8.tar.gz * && aws s3 cp python-3.9.8.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.7/ && tar -czf python-3.9.7.tar.gz * && aws s3 cp python-3.9.7.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.6/ && tar -czf python-3.9.6.tar.gz * && aws s3 cp python-3.9.6.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.5/ && tar -czf python-3.9.5.tar.gz * && aws s3 cp python-3.9.5.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.4/ && tar -czf python-3.9.4.tar.gz * && aws s3 cp python-3.9.4.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.3/ && tar -czf python-3.9.3.tar.gz * && aws s3 cp python-3.9.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.2/ && tar -czf python-3.9.2.tar.gz * && aws s3 cp python-3.9.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.1/ && tar -czf python-3.9.1.tar.gz * && aws s3 cp python-3.9.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
          fi

      - name: Upload Python package to S3
        if: github.ref == 'refs/heads/main'
        run: |
          OS=$(uname -s)
          if [[ $OS == "Linux" ]]; then
            cd $HOME/.vmn/python/v3.12.3/ && tar -czf python-3.12.3.tar.gz * && aws s3 cp python-3.12.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.12.2/ && tar -czf python-3.12.2.tar.gz * && aws s3 cp python-3.12.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.12.1/ && tar -czf python-3.12.1.tar.gz * && aws s3 cp python-3.12.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/

            cd $HOME/.vmn/python/v3.11.9/ && tar -czf python-3.11.9.tar.gz * && aws s3 cp python-3.11.9.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.8/ && tar -czf python-3.11.8.tar.gz * && aws s3 cp python-3.11.8.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.7/ && tar -czf python-3.11.7.tar.gz * && aws s3 cp python-3.11.7.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.6/ && tar -czf python-3.11.6.tar.gz * && aws s3 cp python-3.11.6.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.5/ && tar -czf python-3.11.5.tar.gz * && aws s3 cp python-3.11.5.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.4/ && tar -czf python-3.11.4.tar.gz * && aws s3 cp python-3.11.4.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.3/ && tar -czf python-3.11.3.tar.gz * && aws s3 cp python-3.11.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.2/ && tar -czf python-3.11.2.tar.gz * && aws s3 cp python-3.11.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.11.1/ && tar -czf python-3.11.1.tar.gz * && aws s3 cp python-3.11.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/

            cd $HOME/.vmn/python/v3.10.14/ && tar -czf python-3.10.14.tar.gz * && aws s3 cp python-3.10.14.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.13/ && tar -czf python-3.10.13.tar.gz * && aws s3 cp python-3.10.13.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.12/ && tar -czf python-3.10.12.tar.gz * && aws s3 cp python-3.10.12.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.11/ && tar -czf python-3.10.11.tar.gz * && aws s3 cp python-3.10.11.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.10/ && tar -czf python-3.10.10.tar.gz * && aws s3 cp python-3.10.10.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.9/ && tar -czf python-3.10.9.tar.gz * && aws s3 cp python-3.10.9.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.8/ && tar -czf python-3.10.8.tar.gz * && aws s3 cp python-3.10.8.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.7/ && tar -czf python-3.10.7.tar.gz * && aws s3 cp python-3.10.7.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.6/ && tar -czf python-3.10.6.tar.gz * && aws s3 cp python-3.10.6.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.5/ && tar -czf python-3.10.5.tar.gz * && aws s3 cp python-3.10.5.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.4/ && tar -czf python-3.10.4.tar.gz * && aws s3 cp python-3.10.4.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.3/ && tar -czf python-3.10.3.tar.gz * && aws s3 cp python-3.10.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.2/ && tar -czf python-3.10.2.tar.gz * && aws s3 cp python-3.10.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.10.1/ && tar -czf python-3.10.1.tar.gz * && aws s3 cp python-3.10.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/

            cd $HOME/.vmn/python/v3.9.19/ && tar -czf python-3.9.19.tar.gz * && aws s3 cp python-3.9.19.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.18/ && tar -czf python-3.9.18.tar.gz * && aws s3 cp python-3.9.18.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.17/ && tar -czf python-3.9.17.tar.gz * && aws s3 cp python-3.9.17.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.16/ && tar -czf python-3.9.16.tar.gz * && aws s3 cp python-3.9.16.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.15/ && tar -czf python-3.9.15.tar.gz * && aws s3 cp python-3.9.15.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.14/ && tar -czf python-3.9.14.tar.gz * && aws s3 cp python-3.9.14.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.13/ && tar -czf python-3.9.13.tar.gz * && aws s3 cp python-3.9.13.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.12/ && tar -czf python-3.9.12.tar.gz * && aws s3 cp python-3.9.12.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.11/ && tar -czf python-3.9.11.tar.gz * && aws s3 cp python-3.9.11.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.10/ && tar -czf python-3.9.10.tar.gz * && aws s3 cp python-3.9.10.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.9/ && tar -czf python-3.9.9.tar.gz * && aws s3 cp python-3.9.9.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.8/ && tar -czf python-3.9.8.tar.gz * && aws s3 cp python-3.9.8.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.7/ && tar -czf python-3.9.7.tar.gz * && aws s3 cp python-3.9.7.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.6/ && tar -czf python-3.9.6.tar.gz * && aws s3 cp python-3.9.6.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.5/ && tar -czf python-3.9.5.tar.gz * && aws s3 cp python-3.9.5.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.4/ && tar -czf python-3.9.4.tar.gz * && aws s3 cp python-3.9.4.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.3/ && tar -czf python-3.9.3.tar.gz * && aws s3 cp python-3.9.3.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.2/ && tar -czf python-3.9.2.tar.gz * && aws s3 cp python-3.9.2.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
            cd $HOME/.vmn/python/v3.9.1/ && tar -czf python-3.9.1.tar.gz * && aws s3 cp python-3.9.1.tar.gz s3://repo.vineelsai.com/linux/generic/amd64/
          elif [[ $OS == "Darwin" ]]; then
            cd $HOME/.vmn/python/v3.12.3/ && tar -czf python-3.12.3.tar.gz * && aws s3 cp python-3.12.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.12.2/ && tar -czf python-3.12.2.tar.gz * && aws s3 cp python-3.12.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.12.1/ && tar -czf python-3.12.1.tar.gz * && aws s3 cp python-3.12.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/

            cd $HOME/.vmn/python/v3.11.9/ && tar -czf python-3.11.9.tar.gz * && aws s3 cp python-3.11.9.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.8/ && tar -czf python-3.11.8.tar.gz * && aws s3 cp python-3.11.8.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.7/ && tar -czf python-3.11.7.tar.gz * && aws s3 cp python-3.11.7.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.6/ && tar -czf python-3.11.6.tar.gz * && aws s3 cp python-3.11.6.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.5/ && tar -czf python-3.11.5.tar.gz * && aws s3 cp python-3.11.5.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.4/ && tar -czf python-3.11.4.tar.gz * && aws s3 cp python-3.11.4.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.3/ && tar -czf python-3.11.3.tar.gz * && aws s3 cp python-3.11.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.2/ && tar -czf python-3.11.2.tar.gz * && aws s3 cp python-3.11.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.11.1/ && tar -czf python-3.11.1.tar.gz * && aws s3 cp python-3.11.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/

            cd $HOME/.vmn/python/v3.10.14/ && tar -czf python-3.10.14.tar.gz * && aws s3 cp python-3.10.14.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.13/ && tar -czf python-3.10.13.tar.gz * && aws s3 cp python-3.10.13.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.12/ && tar -czf python-3.10.12.tar.gz * && aws s3 cp python-3.10.12.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.11/ && tar -czf python-3.10.11.tar.gz * && aws s3 cp python-3.10.11.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.10/ && tar -czf python-3.10.10.tar.gz * && aws s3 cp python-3.10.10.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.9/ && tar -czf python-3.10.9.tar.gz * && aws s3 cp python-3.10.9.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.8/ && tar -czf python-3.10.8.tar.gz * && aws s3 cp python-3.10.8.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.7/ && tar -czf python-3.10.7.tar.gz * && aws s3 cp python-3.10.7.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.6/ && tar -czf python-3.10.6.tar.gz * && aws s3 cp python-3.10.6.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.5/ && tar -czf python-3.10.5.tar.gz * && aws s3 cp python-3.10.5.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.4/ && tar -czf python-3.10.4.tar.gz * && aws s3 cp python-3.10.4.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.3/ && tar -czf python-3.10.3.tar.gz * && aws s3 cp python-3.10.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.2/ && tar -czf python-3.10.2.tar.gz * && aws s3 cp python-3.10.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.10.1/ && tar -czf python-3.10.1.tar.gz * && aws s3 cp python-3.10.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/

            cd $HOME/.vmn/python/v3.9.19/ && tar -czf python-3.9.19.tar.gz * && aws s3 cp python-3.9.19.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.18/ && tar -czf python-3.9.18.tar.gz * && aws s3 cp python-3.9.18.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.17/ && tar -czf python-3.9.17.tar.gz * && aws s3 cp python-3.9.17.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.16/ && tar -czf python-3.9.16.tar.gz * && aws s3 cp python-3.9.16.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.15/ && tar -czf python-3.9.15.tar.gz * && aws s3 cp python-3.9.15.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.14/ && tar -czf python-3.9.14.tar.gz * && aws s3 cp python-3.9.14.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.13/ && tar -czf python-3.9.13.tar.gz * && aws s3 cp python-3.9.13.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.12/ && tar -czf python-3.9.12.tar.gz * && aws s3 cp python-3.9.12.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.11/ && tar -czf python-3.9.11.tar.gz * && aws s3 cp python-3.9.11.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.10/ && tar -czf python-3.9.10.tar.gz * && aws s3 cp python-3.9.10.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.9/ && tar -czf python-3.9.9.tar.gz * && aws s3 cp python-3.9.9.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.8/ && tar -czf python-3.9.8.tar.gz * && aws s3 cp python-3.9.8.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.7/ && tar -czf python-3.9.7.tar.gz * && aws s3 cp python-3.9.7.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.6/ && tar -czf python-3.9.6.tar.gz * && aws s3 cp python-3.9.6.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.5/ && tar -czf python-3.9.5.tar.gz * && aws s3 cp python-3.9.5.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.4/ && tar -czf python-3.9.4.tar.gz * && aws s3 cp python-3.9.4.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.3/ && tar -czf python-3.9.3.tar.gz * && aws s3 cp python-3.9.3.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.2/ && tar -czf python-3.9.2.tar.gz * && aws s3 cp python-3.9.2.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
            cd $HOME/.vmn/python/v3.9.1/ && tar -czf python-3.9.1.tar.gz * && aws s3 cp python-3.9.1.tar.gz s3://repo.vineelsai.com/darwin/generic/arm64/
          fi

  release:
    name: "Tagged Release"
    runs-on: "ubuntu-latest"
    needs: test
    if: github.event_name == 'push' && startsWith(github.ref, 'refs/tags/v')
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: ${{ env.GoVersion }}

      - name: Install zip
        run: sudo apt install zip

      - name: "Build"
        env:
          tag: ${{ github.ref_name }}
        run: |
          # Windows AMD64
          env GOOS=windows GOARCH=amd64 go build -ldflags="-X 'vineelsai.com/vmn/src.Version=$tag'"
          zip vmn-windows-amd64.zip vmn.exe
          go clean

          # Windows ARM64
          env GOOS=windows GOARCH=arm64 go build -ldflags="-X 'vineelsai.com/vmn/src.Version=$tag'"
          zip vmn-windows-arm64.zip vmn.exe
          go clean

          # Linux AMD64
          env GOOS=linux GOARCH=amd64 go build -ldflags="-X 'vineelsai.com/vmn/src.Version=$tag'"
          tar -czvf vmn-linux-amd64.tar.gz vmn

          # Debian AMD64
          mkdir -p package/vmn-debian/usr/bin
          mkdir -p package/vmn-debian/DEBIAN
          cp vmn package/vmn-debian/usr/bin
          release=$(echo "$tag" | awk '{gsub("v",""); print}')
          printf "Package: vmn\nVersion: $release\nSection: custom\nPriority: optional\nArchitecture: amd64\nMaintainer: Vineel Sai\nDescription: Version Manager for Node\nHomepage: https://vineelsai.com\n" > package/vmn-debian/DEBIAN/control
          dpkg-deb --build package/vmn-debian vmn-linux-amd64.deb
          rm -rf package
          go clean

          # Linux ARM64
          env GOOS=linux GOARCH=arm64 go build -ldflags="-X 'vineelsai.com/vmn/src.Version=$tag'"
          tar -czvf vmn-linux-arm64.tar.gz vmn

          # Debian ARM64
          mkdir -p package/vmn-debian/usr/bin
          mkdir -p package/vmn-debian/DEBIAN
          cp vmn package/vmn-debian/usr/bin
          release=$(echo "$tag" | awk '{gsub("v",""); print}')
          printf "Package: vmn\nVersion: $release\nSection: custom\nPriority: optional\nArchitecture: arm64\nMaintainer: Vineel Sai\nDescription: Version Manager for Node\nHomepage: https://vineelsai.com\n" > package/vmn-debian/DEBIAN/control
          dpkg-deb --build package/vmn-debian vmn-linux-arm64.deb
          rm -rf package
          go clean

          # MacOS AMD64
          env GOOS=darwin GOARCH=amd64 go build -ldflags="-X 'vineelsai.com/vmn/src.Version=$tag'"
          tar -czvf vmn-macos-amd64.tar.gz vmn
          go clean

          # MacOS ARM64
          env GOOS=darwin GOARCH=arm64 go build -ldflags="-X 'vineelsai.com/vmn/src.Version=$tag'"
          tar -czvf vmn-macos-arm64.tar.gz vmn
          go clean

      - uses: "marvinpinto/action-automatic-releases@latest"
        with:
          repo_token: "${{ secrets.RELEASE_TOKEN }}"
          prerelease: false
          files: |
            *.tar.gz
            *.zip
            *.deb
